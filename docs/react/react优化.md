# React æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆæ€»ç»“

React æä¾›äº†å¤šç§ä¼˜åŒ–ç»„ä»¶æ¸²æŸ“æ€§èƒ½çš„æ‰‹æ®µï¼Œä»¥ä¸‹æ˜¯å¸¸ç”¨çš„å‡ ç§ï¼š`shouldComponentUpdate`ã€`PureComponent`ã€`React.memo` å’Œ `keys`ã€‚

---

## 1. `shouldComponentUpdate`

### ç®€ä»‹

ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¯ç”¨äºæ‰‹åŠ¨æ§åˆ¶ç»„ä»¶æ˜¯å¦é‡æ–°æ¸²æŸ“ã€‚

### ç¤ºä¾‹ä»£ç 

```tsx
class MyComponent extends React.Component {
	shouldComponentUpdate(nextProps, nextState) {
		// åªæœ‰å½“ props å˜åŒ–æ—¶æ‰é‡æ–°æ¸²æŸ“
		return nextProps.value !== this.props.value;
	}

	render() {
		console.log('Rendering MyComponent');
		return <div>{this.props.value}</div>;
	}
}
```

### ä¼˜ç‚¹

- ç²¾ç»†æ§åˆ¶ç»„ä»¶æ›´æ–°é€»è¾‘ï¼Œé€‚ç”¨äºå¤æ‚æ¯”è¾ƒã€‚
- å¯é…åˆç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ Immutable.jsï¼‰å®ç°é«˜æ€§èƒ½æ›´æ–°ã€‚

### ç¼ºç‚¹

- å†™æ³•ç¹çï¼Œéœ€è¦æ‰‹åŠ¨æ¯”è¾ƒæ¯ä¸ª propã€‚
- æ˜“å‡ºé”™ï¼Œå¢åŠ ç»´æŠ¤æˆæœ¬ã€‚

### ä½¿ç”¨åœºæ™¯

- ç±»ç»„ä»¶ä¸­ï¼Œæ€§èƒ½ç“¶é¢ˆæ˜æ˜¾æ—¶ã€‚
- éœ€è¦å¤æ‚æˆ–è‡ªå®šä¹‰çš„ props å¯¹æ¯”é€»è¾‘ã€‚

---

## 2. `PureComponent`

### ç®€ä»‹

React æä¾›çš„ä¼˜åŒ–å‹ç±»ç»„ä»¶ï¼Œå†…éƒ¨å®ç°äº†æµ…æ¯”è¾ƒçš„ `shouldComponentUpdate`ã€‚

### ç¤ºä¾‹ä»£ç 

```tsx
class MyPureComponent extends React.PureComponent {
	render() {
		console.log('Rendering MyPureComponent');
		return <div>{this.props.value}</div>;
	}
}
```

### ä¼˜ç‚¹

- è‡ªåŠ¨å®ç°æµ…æ¯”è¾ƒï¼Œç®€åŒ–ä»£ç ã€‚
- å‡å°‘ä¸å¿…è¦çš„æ¸²æŸ“ã€‚

### ç¼ºç‚¹

- ä½¿ç”¨æµ…æ¯”è¾ƒï¼Œå¯¹äºå¤æ‚åµŒå¥—å¯¹è±¡æ— æ³•æ£€æµ‹æ·±å±‚å˜åŒ–ã€‚
- å¦‚æœ props æ˜¯é¢‘ç¹å˜åŒ–çš„å¼•ç”¨ç±»å‹ï¼Œå¯èƒ½å¯¼è‡´è¯¯åˆ¤ã€‚

### ä½¿ç”¨åœºæ™¯

- ç±»ç»„ä»¶ä¸” props/state ç®€å•æˆ–ä¸å¯å˜ã€‚
- å¸Œæœ›é¿å…æ‰‹åŠ¨å†™ `shouldComponentUpdate`ã€‚

---

## 3. `React.memo`

### ç®€ä»‹

ç”¨äºå‡½æ•°ç»„ä»¶çš„é«˜é˜¶ç»„ä»¶ï¼Œæä¾›æµ…æ¯”è¾ƒçš„ props ä¼˜åŒ–åŠŸèƒ½ã€‚

### ç¤ºä¾‹ä»£ç 

```tsx
const MyComponent = ({ value }) => {
	console.log('Rendering MyComponent');
	return <div>{value}</div>;
};

const MemoizedComponent = React.memo(MyComponent);
```

### è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°

```tsx
const MemoizedComponent = React.memo(MyComponent, (prevProps, nextProps) => {
	return prevProps.value === nextProps.value;
});
```

### ä¼˜ç‚¹

- å¯¹å‡½æ•°ç»„ä»¶ä¼˜åŒ–ç®€å•ç›´æ¥ã€‚
- æ”¯æŒè‡ªå®šä¹‰ props æ¯”è¾ƒé€»è¾‘ã€‚

### ç¼ºç‚¹

- åŒæ ·æ˜¯æµ…æ¯”è¾ƒï¼Œå¤æ‚å¯¹è±¡æ˜“è¯¯åˆ¤ã€‚
- å¯¹äºå†…éƒ¨çŠ¶æ€æˆ–å‰¯ä½œç”¨é¢‘ç¹çš„ç»„ä»¶ä½œç”¨æœ‰é™ã€‚

### ä½¿ç”¨åœºæ™¯

- å‡½æ•°ç»„ä»¶é¢‘ç¹è¢«çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä½†è‡ªèº« props æœªå˜ã€‚
- é…åˆä¸å¯å˜æ•°æ®ç»“æ„æ•ˆæœæœ€ä½³ã€‚

---

## 4. `keys`

### ç®€ä»‹

React ç”¨ `key` æ¥æ ‡è¯†ç»„ä»¶ï¼Œä½¿å¾—åˆ—è¡¨æ›´æ–°æ›´é«˜æ•ˆå‡†ç¡®ã€‚

### ç¤ºä¾‹ä»£ç 

```tsx
const List = ({ items }) => (
	<ul>
		{items.map((item) => (
			<li key={item.id}>{item.name}</li>
		))}
	</ul>
);
```

### ä¼˜ç‚¹

- å¸®åŠ© React ç²¾ç¡®è¯†åˆ«å“ªäº›å…ƒç´ å˜åŒ–ã€‚
- å‡å°‘ DOM æ“ä½œï¼Œæé«˜æ¸²æŸ“æ€§èƒ½ã€‚

### ç¼ºç‚¹

- ä½¿ç”¨ index ä½œä¸º key ä¼šå¯¼è‡´é‡æ¸²æŸ“å’ŒçŠ¶æ€é”™ä¹±ã€‚
- å¦‚æœ key ä¸å”¯ä¸€ï¼Œä¼šé€ æˆæ€§èƒ½é—®é¢˜æˆ–æ¸²æŸ“ bugã€‚

### ä½¿ç”¨åœºæ™¯

- æ¸²æŸ“åˆ—è¡¨æ—¶ï¼ŒåŠ¡å¿…æ·»åŠ å”¯ä¸€çš„ keyã€‚
- å°½é‡ä½¿ç”¨ç¨³å®šä¸”å”¯ä¸€çš„ä¸šåŠ¡ ID ä½œä¸º keyã€‚

---

## 5. `useMemo`

### ç®€ä»‹

ç”¨äºç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…ç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½é‡å¤æ‰§è¡Œå¼€é”€å¤§çš„è¿ç®—ã€‚

### ç¤ºä¾‹ä»£ç 

```tsx
import React, { useMemo } from 'react';

const ExpensiveComponent = ({ num }) => {
	const computed = useMemo(() => {
		console.log('Calculating...');
		return num * 2; // æ¨¡æ‹Ÿå¼€é”€å¤§çš„è®¡ç®—
	}, [num]);

	return <div>Result: {computed}</div>;
};
```

### ä¼˜ç‚¹

- é¿å…é‡å¤è®¡ç®—ï¼Œæé«˜æ€§èƒ½ã€‚
- é€‚åˆè®¡ç®—è¿‡ç¨‹å¤æ‚ã€ä¾èµ–ä¸é¢‘ç¹å˜åŠ¨çš„åœºæ™¯ã€‚

### ç¼ºç‚¹

- æ»¥ç”¨å¯èƒ½åè€Œé™ä½æ€§èƒ½ï¼ˆç¼“å­˜å¼€é”€ > è®¡ç®—å¼€é”€ï¼‰ã€‚
- ä¾èµ–é¡¹ä¼ é”™å¯èƒ½å¯¼è‡´ç¼“å­˜æ— æ•ˆæˆ–é”™è¯¯ã€‚

### ä½¿ç”¨åœºæ™¯

- å‡½æ•°ç»„ä»¶ä¸­åŒ…å«å¤æ‚è®¡ç®—é€»è¾‘ã€‚
- è®¡ç®—å€¼ä¸æ¸²æŸ“è§£è€¦ï¼Œç»“æœå¯ç¼“å­˜ã€‚

---

## 6. `useCallback`

### ç®€ä»‹

ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé˜²æ­¢å› å‡½æ•°å¼•ç”¨å˜åŒ–å¯¼è‡´å­ç»„ä»¶ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“ã€‚

### ç¤ºä¾‹ä»£ç 

```tsx
import React, { useCallback } from 'react';

const Child = React.memo(({ onClick }) => {
	console.log('Rendering Child');
	return <button onClick={onClick}>Click me</button>;
});

const Parent = () => {
	const handleClick = useCallback(() => {
		console.log('Clicked!');
	}, []);

	return <Child onClick={handleClick} />;
};
```

### ä¼˜ç‚¹

- é¿å…å­ç»„ä»¶ä¸å¿…è¦çš„æ¸²æŸ“ã€‚
- é…åˆ `React.memo` æ•ˆæœæ›´ä½³ã€‚

### ç¼ºç‚¹

- ä¸ `useMemo` ç±»ä¼¼ï¼Œæ»¥ç”¨å¯èƒ½é€‚å¾—å…¶åã€‚
- è‹¥ä¾èµ–é¢‘ç¹å˜åŒ–ï¼Œæ•ˆæœæœ‰é™ã€‚

### ä½¿ç”¨åœºæ™¯

- å­ç»„ä»¶ä½¿ç”¨ `React.memo` æ—¶ï¼Œä¼ å…¥çš„æ˜¯å‡½æ•° propsã€‚
- å‡½æ•°ç»„ä»¶ä¸­å‡½æ•°ä½œä¸ºä¾èµ–é¡¹æ—¶éœ€è¦ç¨³å®šå¼•ç”¨ã€‚

---

## 7. `useTransition`

### ç®€ä»‹

å°†æ›´æ–°æ ‡è®°ä¸ºâ€œå¯ä¸­æ–­çš„ä½ä¼˜å…ˆçº§ä»»åŠ¡â€ï¼Œä¼˜åŒ–å“åº”æ€§èƒ½ï¼Œå¸¸ç”¨äºè¾“å…¥æ¡†ã€æœç´¢ã€åˆ†é¡µç­‰åœºæ™¯ã€‚

### ç¤ºä¾‹ä»£ç 

```tsx
import React, { useState, useTransition } from 'react';

const Search = () => {
	const [query, setQuery] = useState('');
	const [list, setList] = useState([]);
	const [isPending, startTransition] = useTransition();

	const handleChange = (e) => {
		const value = e.target.value;
		setQuery(value);

		startTransition(() => {
			// æ¨¡æ‹Ÿç­›é€‰æ•°æ®
			const filtered = Array(10000)
				.fill(0)
				.map((_, i) => `Item ${i}`)
				.filter((item) => item.includes(value));
			setList(filtered);
		});
	};

	return (
		<div>
			<input value={query} onChange={handleChange} />
			{isPending && <p>Loading...</p>}
			<ul>
				{list.map((item, i) => (
					<li key={i}>{item}</li>
				))}
			</ul>
		</div>
	);
};
```

### ä¼˜ç‚¹

- ä¸é˜»å¡é«˜ä¼˜å…ˆçº§ä»»åŠ¡ï¼ˆå¦‚è¾“å…¥å“åº”ï¼‰ã€‚
- æé«˜ç”¨æˆ·ä½“éªŒï¼Œå¸¸ç”¨äºå¤§æ•°æ®å¤„ç†æˆ–é¡µé¢åˆ‡æ¢æ—¶ã€‚

### ç¼ºç‚¹

- é€‚ç”¨äºå¹¶å‘æ¨¡å¼ï¼Œéœ€ React 18+ã€‚
- å¯¹ SEO æˆ– SSR æ”¯æŒè¾ƒå·®ã€‚

### ä½¿ç”¨åœºæ™¯

- æœç´¢ã€åˆ†é¡µã€å¤§å‹è¡¨æ ¼åŠ è½½ç­‰äº¤äº’ã€‚
- è¾“å…¥æ¡†è”åŠ¨æ¸²æŸ“åˆ—è¡¨åœºæ™¯ï¼Œé¿å…å¡é¡¿ã€‚

---

## Hooks ä¼˜åŒ–å¯¹æ¯”æ€»ç»“

| ä¼˜åŒ–æ–¹å¼                | ç±»å‹             | é€‚ç”¨åœºæ™¯                                          | æ¨èçº§åˆ«   |
| ----------------------- | ---------------- | ------------------------------------------------- | ---------- |
| `shouldComponentUpdate` | ç±»ç»„ä»¶           | éœ€è¦ç²¾ç»†æ‰‹åŠ¨æ§åˆ¶æ›´æ–°é€»è¾‘æ—¶ï¼Œæ€§èƒ½å…³é”®ç»„ä»¶          | â­â­â­     |
| `PureComponent`         | ç±»ç»„ä»¶           | props/state ç®€å•ï¼Œä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„              | â­â­â­â­   |
| `React.memo`            | å‡½æ•°ç»„ä»¶         | props ç®€å•ã€ä¸ç»å¸¸å˜åŒ–ï¼Œé¢‘ç¹ re-render çš„å‡½æ•°ç»„ä»¶ | â­â­â­â­   |
| `keys`                  | æ‰€æœ‰ç»„ä»¶         | æ¸²æŸ“åˆ—è¡¨æ—¶çš„å¿…è¦æ‰‹æ®µï¼Œå½±å“ React diff ç®—æ³•å‡†ç¡®æ€§  | â­â­â­â­â­ |
| `useMemo`               | Hook             | å¤æ‚è®¡ç®—ã€é¿å…é‡å¤è¿ç®—                            | â­â­â­     |
| `useCallback`           | Hook             | ç¨³å®šå‡½æ•°å¼•ç”¨ã€é…åˆ React.memo ä½¿ç”¨                | â­â­â­â­   |
| `useTransition`         | Hook (React 18+) | è¾“å…¥å»¶è¿Ÿå¤„ç†ã€å¤§æ•°æ®æ¸²æŸ“                          | â­â­â­â­   |

> ğŸ’¡ **æœ€ä½³å®è·µå»ºè®®**ï¼š  
> é…åˆä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ï¼ˆå¦‚ `immer`ã€`immutable.js`ï¼‰+ `React.memo` æˆ– `PureComponent`ï¼Œèƒ½æ˜¾è‘—æå‡ç»„ä»¶æ€§èƒ½ã€‚
> Hooks ä¼˜åŒ–å¹¶éè¶Šå¤šè¶Šå¥½ï¼Œåº”ç»“åˆæ€§èƒ½ç“¶é¢ˆåˆ†æåˆç†ä½¿ç”¨ï¼Œå°¤å…¶é¿å…è¿‡åº¦ä¼˜åŒ–å¯¼è‡´â€œå¾®æ€§èƒ½æŸå¤±â€åè€ŒåŠ é‡è´Ÿæ‹…ã€‚
