# SSE

## å‰è¨€

æˆ‘å€‘çŸ¥é“åœ¨ä½¿ç”¨ ChatGPT çš„æ™‚å€™ï¼Œç­”æ¡ˆçš„å‘ˆç¾å½¢å¼æ˜¯ä¸€å€‹å­—ä¸€å€‹å­—æ‰“å‡ºä¾†çš„ï¼Œé€™æ¨£çš„æµå¼å‚³è¼¸ï¼Œå¾ˆæ˜é¡¯ä½¿ç”¨çš„æ˜¯æœå‹™ç«¯æ¨é€æŠ€è¡“ï¼Œä½†ä¸¦ä¸æ˜¯ç”¨çš„ websocketï¼Œè€Œæ˜¯å¦å¤–ä¸€ç§ SSE æŠ€è¡“ã€‚

## ä»€ä¹ˆæ˜¯ SSEï¼ˆServer-Sent Eventsï¼‰ï¼Ÿ

**SSEï¼ˆServer-Sent Eventsï¼‰** æ˜¯ä¸€ç§åŸºäº HTTP çš„å•å‘é€šä¿¡åè®®ï¼Œå…è®¸æœåŠ¡å™¨å‘æµè§ˆå™¨ **æŒç»­æ¨é€æ•°æ®**ï¼Œæ— éœ€å®¢æˆ·ç«¯é¢‘ç¹è½®è¯¢ã€‚

å®ƒé€šè¿‡æµè§ˆå™¨å†…ç½®çš„ `EventSource` å¯¹è±¡å»ºç«‹è¿æ¥ï¼Œ**åªä»æœåŠ¡å™¨åˆ°å®¢æˆ·ç«¯**å•å‘ä¼ è¾“æ•°æ®ï¼Œå¸¸ç”¨äºå®æ—¶æ—¥å¿—ã€è¡Œæƒ…ã€æ¶ˆæ¯é€šçŸ¥ç­‰è½»é‡çº§å®æ—¶åœºæ™¯ã€‚

## SSE ç‰¹ç‚¹

- å»ºç«‹åœ¨æ ‡å‡† HTTP åè®®ä¹‹ä¸Šï¼ˆä½¿ç”¨ `text/event-stream`ï¼‰ã€‚
- å®¢æˆ·ç«¯é€šè¿‡ `EventSource` æ¥æ”¶æœåŠ¡ç«¯æ¨é€çš„æ¶ˆæ¯ã€‚
- **åªæ”¯æŒæœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯å•å‘é€šä¿¡**ã€‚
- è‡ªåŠ¨é‡è¿æœºåˆ¶ï¼Œè¿æ¥æ–­å¼€åè‡ªåŠ¨å°è¯•é‡è¿ã€‚
- å¤©ç„¶æ”¯æŒ HTTP ç¼“å­˜ã€ä»£ç†ã€å®‰å…¨ç­–ç•¥ã€‚

### ğŸŒ å®¢æˆ·ç«¯ä»£ç ç¤ºä¾‹

```js
const evtSource = new EventSource('/sse');

evtSource.onmessage = (event) => {
	console.log('Message from server:', event.data);
};

evtSource.onerror = () => {
	console.error('SSE connection error.');
};
```

---

## ğŸ”„ SSE vs WebSocket å¯¹æ¯”

| ç‰¹æ€§              | SSE                            | WebSocket                         |
| ----------------- | ------------------------------ | --------------------------------- |
| é€šä¿¡æ–¹å¼          | å•å‘ï¼ˆæœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ï¼‰        | åŒå‘ï¼ˆå®¢æˆ·ç«¯ â†” æœåŠ¡å™¨ï¼‰           |
| åè®®              | HTTPï¼ˆ`text/event-stream`ï¼‰    | è‡ªå®šä¹‰ WebSocket åè®®ï¼ˆws / wssï¼‰ |
| å»ºç«‹è¿æ¥          | ç®€å•ï¼ˆç›´æ¥åŸºäº HTTPï¼‰          | éœ€æ¡æ‰‹å‡çº§ä¸º WebSocket            |
| å®¢æˆ·ç«¯æ”¯æŒ        | æ‰€æœ‰ç°ä»£æµè§ˆå™¨                 | æ‰€æœ‰ç°ä»£æµè§ˆå™¨                    |
| é‡è¿æœºåˆ¶          | å†…ç½®è‡ªåŠ¨é‡è¿                   | éœ€æ‰‹åŠ¨å¤„ç†                        |
| æ¶ˆæ¯æ ¼å¼          | æ–‡æœ¬æµï¼Œæ ‡å‡†æ ¼å¼               | è‡ªç”±æ ¼å¼ï¼ˆäºŒè¿›åˆ¶ã€JSONã€æ–‡æœ¬ï¼‰    |
| å‹åŠ›å¤„ç†/å¹¶å‘æ€§èƒ½ | è¾ƒé€‚åˆè½»é‡æ¨é€                 | æ›´é€‚åˆé«˜é¢‘ã€å¤æ‚çš„å®æ—¶äº¤äº’        |
| å®‰å…¨æ€§/ä¸­é—´ä»¶æ”¯æŒ | å®Œç¾å…¼å®¹ HTTP ä»£ç†ã€é˜²ç«å¢™     | éƒ¨åˆ†ä»£ç†éœ€é¢å¤–é…ç½®                |
| ä½¿ç”¨åœºæ™¯          | æ—¥å¿—æµã€é€šçŸ¥ã€è¡Œæƒ…ã€çŠ¶æ€æ›´æ–°ç­‰ | èŠå¤©ç³»ç»Ÿã€åœ¨çº¿æ¸¸æˆã€åä½œç¼–è¾‘ç­‰    |

---

## âœ… SSE é€‚åˆåœºæ™¯

- æ–°é—»æ›´æ–°/è‚¡ç¥¨æ¨é€
- æœåŠ¡ç«¯æ—¥å¿—å®æ—¶æ˜¾ç¤º
- å¼‚æ­¥ä»»åŠ¡çŠ¶æ€é€šçŸ¥
- IoT æ•°æ®å®æ—¶å±•ç¤º

---

## âŒ SSE ä¸é€‚åˆçš„æƒ…å†µ

- éœ€è¦ **åŒå‘é€šä¿¡** çš„åº”ç”¨ï¼ˆæ¯”å¦‚ï¼šèŠå¤©ã€WebRTC ä¿¡ä»¤ï¼‰
- æœåŠ¡ç«¯æ•°æ®é‡å¤§ä¸”é¢‘ç¹
- å®¢æˆ·ç«¯ä¸ºéæµè§ˆå™¨ç¯å¢ƒï¼ˆéœ€é¢å¤– polyfillï¼‰

## ğŸ”š æ€»ç»“

| æŠ€æœ¯          | ä¼˜ç‚¹                           | ç¼ºç‚¹                      |
| ------------- | ------------------------------ | ------------------------- |
| **SSE**       | ç®€å•ã€è½»é‡ã€å†…ç½®é‡è¿ã€å®‰å…¨æ€§å¥½ | å•å‘é€šä¿¡ã€ä¸æ”¯æŒäºŒè¿›åˆ¶    |
| **WebSocket** | åŒå‘é€šä¿¡ã€æ”¯æŒé«˜å¹¶å‘å’ŒäºŒè¿›åˆ¶   | å®ç°å¤æ‚ã€éœ€ç®¡ç†è¿æ¥/å¿ƒè·³ |

> ğŸ§  **é€‰æ‹©å»ºè®®**ï¼š
>
> - å¦‚æœä½ åªéœ€è¦ä»æœåŠ¡å™¨æ¨é€æ•°æ®åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”ä¸æƒ³å¼•å…¥å¤æ‚é€šä¿¡é€»è¾‘ â€”â€” ç”¨ **SSE**ã€‚
> - å¦‚æœä½ éœ€è¦åŒå‘äº¤äº’ã€é¢‘ç¹æ¶ˆæ¯ä¼ è¾“æˆ–éœ€è¦å‘é€äºŒè¿›åˆ¶æ•°æ® â€”â€” ç”¨ **WebSocket**ã€‚

![ssevswebsocket](./images/ssevswebsocket.jpeg)
